<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Application - XGENAI</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="../careers.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        // Get job info from URL
        const urlParams = new URLSearchParams(window.location.search);
        const jobId = urlParams.get('job');
        
        const jobTitles = {
            'job1': 'AI Intern',
            'job2': 'Machine Learning Intern',
            'job3': 'MedTech Intern',
            'job4': 'Software Developer Intern',
            'job5': 'Data Analyst Intern',
            'job6': 'ML Data Engineer Intern'
        };
        
        document.addEventListener('DOMContentLoaded', () => {
            const jobTitle = jobTitles[jobId] || 'Intern';
            document.title = `Apply for ${jobTitle} - XGENAI`;
            document.querySelector('h1').textContent = `Apply for ${jobTitle}`;
            document.querySelector('input[name="position"]').value = jobTitle;
        });
    </script>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="/" class="logo">
                <h2>XGENAI</h2>
            </a>
            <div class="nav-menu">
                <a href="/">Home</a>
                <a href="/careers">Careers</a>
            </div>
        </div>
    </nav>

    <div class="careers-container" style="padding-top: 100px;">
        <div class="container">
            <h1>Apply for Position</h1>
            <form id="applicationForm" style="max-width: 700px; margin: 2rem auto; background: rgba(255, 255, 255, 0.03); padding: 2rem; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.1);">
                <input type="hidden" name="position" value="">
                
                <div style="margin-bottom: 1.5rem;">
                    <label for="fullName" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #e5e5e5;">Full Name *</label>
                    <input type="text" id="fullName" name="fullName" required style="width: 100%; padding: 0.75rem; border: 1px solid #444; border-radius: 8px; background: rgba(0,0,0,0.3); color: white;">
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label for="email" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #e5e5e5;">Email Address *</label>
                    <input type="email" id="email" name="email" required style="width: 100%; padding: 0.75rem; border: 1px solid #444; border-radius: 8px; background: rgba(0,0,0,0.3); color: white;">
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label for="phone" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #e5e5e5;">Phone Number *</label>
                    <input type="tel" id="phone" name="phone" required style="width: 100%; padding: 0.75rem; border: 1px solid #444; border-radius: 8px; background: rgba(0,0,0,0.3); color: white;">
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label for="address" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #e5e5e5;">Address *</label>
                    <textarea id="address" name="address" rows="2" required style="width: 100%; padding: 0.75rem; border: 1px solid #444; border-radius: 8px; background: rgba(0,0,0,0.3); color: white; resize: vertical;"></textarea>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label for="college" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #e5e5e5;">College/University *</label>
                    <input type="text" id="college" name="college" required style="width: 100%; padding: 0.75rem; border: 1px solid #444; border-radius: 8px; background: rgba(0,0,0,0.3); color: white;">
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label for="degree" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #e5e5e5;">Degree Program *</label>
                    <input type="text" id="degree" name="degree" placeholder="e.g., B.Tech in Computer Science" required style="width: 100%; padding: 0.75rem; border: 1px solid #444; border-radius: 8px; background: rgba(0,0,0,0.3); color: white;">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                    <div>
                        <label for="semester" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #e5e5e5;">Current Semester *</label>
                        <input type="text" id="semester" name="semester" required style="width: 100%; padding: 0.75rem; border: 1px solid #444; border-radius: 8px; background: rgba(0,0,0,0.3); color: white;">
                    </div>
                    <div>
                        <label for="year" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #e5e5e5;">Graduation Year *</label>
                        <input type="text" id="year" name="year" required style="width: 100%; padding: 0.75rem; border: 1px solid #444; border-radius: 8px; background: rgba(0,0,0,0.3); color: white;">
                    </div>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label for="resume" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #e5e5e5;">Upload Resume (PDF) *</label>
                    <input type="file" id="resume" name="resume" accept=".pdf,.doc,.docx" required style="width: 100%; padding: 0.75rem; border: 1px solid #444; border-radius: 8px; background: rgba(0,0,0,0.3); color: white;">
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label for="linkedin" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #e5e5e5;">LinkedIn Profile (Optional)</label>
                    <input type="url" id="linkedin" name="linkedin" placeholder="https://linkedin.com/in/yourprofile" style="width: 100%; padding: 0.75rem; border: 1px solid #444; border-radius: 8px; background: rgba(0,0,0,0.3); color: white;">
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label for="github" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #e5e5e5;">GitHub Profile (Optional)</label>
                    <input type="url" id="github" name="github" placeholder="https://github.com/yourusername" style="width: 100%; padding: 0.75rem; border: 1px solid #444; border-radius: 8px; background: rgba(0,0,0,0.3); color: white;">
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <label for="about" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #e5e5e5;">About Yourself *</label>
                    <textarea id="about" name="about" rows="4" required placeholder="Tell us about yourself, your skills, and why you're interested in this position..." style="width: 100%; padding: 0.75rem; border: 1px solid #444; border-radius: 8px; background: rgba(0,0,0,0.3); color: white; resize: vertical;"></textarea>
                </div>

                <button type="submit" class="apply-now-btn" style="width: 100%; padding: 1rem; margin-top: 1rem;">Submit Application</button>
            </form>
        </div>
    </div>
    
    <script>
        // Job Application Form Handler - Inline to avoid path issues
        const API_URL = window.location.origin;

        // Handle form submission
        const form = document.getElementById('applicationForm');
        if (form) {
            form.addEventListener('submit', async (e) => {
                e.preventDefault();

                const submitBtn = form.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.disabled = true;
                submitBtn.textContent = 'Submitting...';

                try {
                    const formData = new FormData(form);
                    
                    // Get position from hidden field
                    const position = formData.get('position') || 'General Application';
                    
                    // Validate resume file
                    const resumeFile = formData.get('resume');
                    if (!resumeFile || !resumeFile.name) {
                        alert('‚ö†Ô∏è Please select a resume file');
                        submitBtn.disabled = false;
                        submitBtn.textContent = originalText;
                        return;
                    }
                    
                    // Validate file type
                    if (!resumeFile.name.toLowerCase().endsWith('.pdf')) {
                        alert('‚ö†Ô∏è Only PDF files are allowed for resume');
                        submitBtn.disabled = false;
                        submitBtn.textContent = originalText;
                        return;
                    }
                    
                    // Validate file size (10MB)
                    if (resumeFile.size > 10 * 1024 * 1024) {
                        alert('‚ö†Ô∏è Resume file must be less than 10MB');
                        submitBtn.disabled = false;
                        submitBtn.textContent = originalText;
                        return;
                    }
                    
                    // Validate other required fields
                    const requiredFields = {
                        'fullName': 'Full Name',
                        'email': 'Email',
                        'phone': 'Phone',
                        'address': 'Address',
                        'college': 'College',
                        'degree': 'Degree',
                        'semester': 'Semester',
                        'year': 'Year',
                        'about': 'About'
                    };
                    
                    const missingFields = [];
                    for (const [field, label] of Object.entries(requiredFields)) {
                        if (!formData.get(field) || formData.get(field).trim() === '') {
                            missingFields.push(label);
                        }
                    }
                    
                    if (missingFields.length > 0) {
                        alert(`‚ö†Ô∏è Please fill in all required fields: ${missingFields.join(', ')}`);
                        submitBtn.disabled = false;
                        submitBtn.textContent = originalText;
                        return;
                    }

                    console.log('üì§ Submitting application with file:', resumeFile.name, `(${(resumeFile.size / 1024).toFixed(2)} KB)`);

                    // Create new FormData with all fields
                    const submitData = new FormData();
                    submitData.append('position', position);
                    submitData.append('fullName', formData.get('fullName'));
                    submitData.append('email', formData.get('email'));
                    submitData.append('phone', formData.get('phone'));
                    submitData.append('address', formData.get('address'));
                    submitData.append('college', formData.get('college'));
                    submitData.append('degree', formData.get('degree'));
                    submitData.append('semester', formData.get('semester'));
                    submitData.append('year', formData.get('year'));
                    submitData.append('about', formData.get('about'));
                    submitData.append('linkedin', formData.get('linkedin') || '');
                    submitData.append('github', formData.get('github') || '');
                    submitData.append('resume', resumeFile);

                    // Submit application with file
                    const response = await fetch(`${API_URL}/api/applications`, {
                        method: 'POST',
                        body: submitData  // Send as multipart/form-data
                    });

                    console.log('üì• Response status:', response.status);
                    const result = await response.json();
                    console.log('üì• Response data:', result);

                    if (response.ok && result.success) {
                        // Show success message
                        console.log('‚úÖ Application submitted successfully!');
                        
                        const successDiv = document.createElement('div');
                        successDiv.style.cssText = 'position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #10b981; color: white; padding: 20px 40px; border-radius: 12px; font-size: 18px; font-weight: 600; box-shadow: 0 10px 40px rgba(16, 185, 129, 0.4); z-index: 9999;';
                        successDiv.innerHTML = '‚úÖ Application Submitted Successfully!<br><small style="font-size: 14px; margin-top: 8px; display: block;">Redirecting to careers page...</small>';
                        document.body.appendChild(successDiv);
                        
                        form.reset();
                        
                        // Redirect to careers page after 2 seconds
                        setTimeout(() => {
                            window.location.href = '/careers';
                        }, 2000);
                    } else {
                        throw new Error(result.error || 'Failed to submit application');
                    }
                } catch (error) {
                    console.error('‚ùå Error:', error);
                    
                    const errorDiv = document.createElement('div');
                    errorDiv.style.cssText = 'position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #ef4444; color: white; padding: 20px 40px; border-radius: 12px; font-size: 16px; font-weight: 600; box-shadow: 0 10px 40px rgba(239, 68, 68, 0.4); z-index: 9999; max-width: 500px; text-align: center;';
                    errorDiv.innerHTML = `‚ùå Failed to submit application<br><small style="font-size: 14px; font-weight: 400; margin-top: 8px; display: block;">${error.message}</small>`;
                    document.body.appendChild(errorDiv);
                    
                    setTimeout(() => {
                        errorDiv.remove();
                    }, 5000);
                    
                    submitBtn.disabled = false;
                    submitBtn.textContent = originalText;
                }
            });
        } else {
            console.error('‚ùå Application form not found!');
        }
    </script>
</body>
</html>